/*! wuxiaobin@xunlei.com 2013-12-30 */
!function(a,b,c){var d="seajs_localStorage_manifest",e="js_storage_",f=new RegExp("^"+e),g="nocache="+(new Date).getTime(),h={},i={},j=function(a){for(var b in a)return!1;return!0},k=function(){console.log("removeAllStorage");for(var a in localStorage)f.test(a)&&(console.log(a),localStorage.removeItem(a))},l=function(a){if(console.log("removeStorageWithoutList"),j(a))return k(),void 0;for(var b in localStorage)f.test(b)&&(a[b]||(console.log(b),localStorage.removeItem(b)))},m=function(a){if(console.log("removeStorageWithList"),!j(a))for(var b in a)console.log(b),localStorage.removeItem(b)};if(a.config.data&&a.config.data.debug)return k(),void 0;var n=a.config.data.manifest;if(n&&localStorage){g=n.appVersion?"appVersion="+n.appVersion:g;var o=localStorage[d];if(o)if(o=JSON.parse(o),o.version!==n.version)k();else{if(n.common&&o.common)for(var p in o.common)o.common[p]===n.common[p]?h[e+a.resolve(p)]=!0:i[e+a.resolve(p)]=!0;o.appVersion!==n.appVersion?l(h):m(i)}else k();localStorage[d]=JSON.stringify(n);var q,r={},s={},t=[],u=function(a,b){var d=c.createElement("script");d.type="text/javascript",d.id=a,d.innerHTML=b,c.body.appendChild(d)},v=function(){for(var b=t.length,c=[],d=0;b>d;d++){var f=t.pop(),g="",h=a.cache[f];console.log(f),h&&h.factory?(g=';define("'+h.id+'",'+JSON.stringify(h.dependencies)+","+h.factory.toString()+")",localStorage[e+h.uri]=g):c.push(f)}for(var i=c.length,d=0;i>d;d++)t.push(c[d])};a.on("resolve",function(b){var c=a.resolve(b.id,b.refUri),d=localStorage;c&&(d[e+c]?s[c]||(s[c]=!0,u(c,d[e+c])):r[c]||(r[c]=!0,t.push(c)))}),a.on("fetch",function(a){return console.log(a),a.requestUri?(a.requestUri=-1!==a.requestUri.indexOf("?")?a.requestUri+"&"+g:a.requestUri+"?"+g,void 0):(a.requestUri=a.uri+"?"+g,void 0)}),a.on("define",function(){clearTimeout(q),q=setTimeout(v,300)}),window.__seajs_plugin_storage={cacheList:r,readyList:s,waitCacheList:t}}}(seajs,window,document);